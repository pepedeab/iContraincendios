{% extends 'layout.twig' %}

{% block titulo 'Informes de ' ~ nombre ~ ' ' ~ apellidos %}

{% block js %}
{{ parent() }}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="/js/vendor/ui/jquery.ui.map.full.min.js"></script>
    <script type="text/javascript">
        
        $(function() {
            var geocoder; 
            var latitud;
            var longitud;
            var lugar = { 'center': '57.7973333,12.0502107', 'zoom': 16 };
            var direccion = '{{ informe.direccion }}' + ', {{ informe.cpostal }}' + ', {{ informe.localidad }}' + ', España';

            geocoder = new google.maps.Geocoder(); 
            geocoder.geocode({ 'address': direccion }, function(results, status) { 
                if (status == google.maps.GeocoderStatus.OK) { 
                    latitud = results[0].geometry.location.lat().toString(); 
                    longitud = results[0].geometry.location.lng().toString(); 
                    alert(latitud+','+longitud);
                    lugar.center = latitud+','+longitud;
                } else { 
                    alert("Geocode was not successful for the following reason: " + status);
                } 
            }); 

            $('#map_canvas').gmap({'center': lugar.center, 'zoom': lugar.zoom, 'disableDefaultUI':false, 'callback': function() {
                var self = this;
                self.addMarker({'position': this.get('map').getCenter() }).click(function() {
                    self.openInfoWindow({ 'content': '{{ informe.direccion }}' + ', {{ informe.cpostal }}' + ', {{ informe.localidad }}' + ', España' }, this);
                }); 
            }});

        });

    </script> 
{% endblock %}

{% block id_page 'id="directions_map"' %}
{% block body_class 'type-home' %}

{% block cabecera %}
    {% include 'cabecera.twig' %}
    {% if is_granted('IS_AUTHENTICATED_FULLY') %}
    {% include 'menu_usuario.twig' %}
    {% else %}
    {% include 'form_login_popup.twig' %}
    {% endif %}
{% endblock %}

{% block contenido_secundario %}
		<div class="content-secondary">
            <div id="jqm-homeheader">
                <h1 id="jqm-logo"><img src="/img/logo.fw.png" alt="iContraincendios" /></h1>
                <p>Calcule las necesidades de una instalación contraincendios.</p>
            </div>

			<p class="intro"><strong>Bienvenido.</strong> iContraincendios es una aplicación para el cálculo de las necesidades para todo tipo de instalaciones contra incendios.</p>
			
			<ul data-role="listview" data-inset="true" data-theme="c" data-dividertheme="f">
				<li data-role="list-divider">Opciones de usuario</li>
				<li><a href="/contacto">Contacto</a></li>				
				<li><a href="/ayuda">Ayuda</a></li>
                <li data-theme="a" data-icon="arrow-d"><a href="/logout" >Desconectar</a></li>
			</ul>
		</div><!--/content-secondary -->
{% endblock %}

{% block contenido_primario %}
		<div class="content-primary">
            <h2>{{ nombre }} {{ apellidos }}</h2><hr>
            <p>A continuación se muestra los datos del informe conjuntamente con los cálculos de las necesidades contraincendios asociados. En el caso que desee realizar algún cambio póngase en contacto con el administrador de la plataforma mediante el botón <strong>Contacto</strong>.</p>
            {% if errores %}
            <p>
                <ul data-role="listview" data-inset="true" data-divider-theme="a" data-count-theme="b">
                    <li data-role="list-divider">{% if errores|length > 1 %}Se han producido errores{% else %}Se ha producido un error{% endif %}<span class="ui-li-count">{{ errores|length }} {% if errores|length > 1 %}errores{% else %}error{% endif %}</span></li>
                    {% for error in errores %}
                        <li data-theme="e" style="font-weight: normal;">{{ error|raw }}</li>
                    {% endfor %}
                </ul>
            </p>
            {% else %}
            <div id="map_content" class="ui-bar-c ui-corner-all ui-shadow" style="padding:1em;">
                <div id="map_canvas" style="height:300px;"></div>
            </div>

            {% endif %}
            <a href="{{ path('usuario.total_informes_tipo', { 'user': app.security.token.user.username, 'tipo': id_uso }) }}" data-role="button" data-theme="b">Volver</a>
		</div><!--/content-primary -->
{% endblock %}
